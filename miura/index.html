<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	    	<meta name="apple-mobile-web-app-capable" content="yes">

		<title>(miura)デモページ</title>

		<script src="//cdn.8thwall.com/web/aframe/8frame-0.9.0.min.js"></script>
	        <script defer src="//cdn.8thwall.com/web/aframe/aframe-animation-component-5.1.2.min.js"></script>
	        <script src="//cdn.8thwall.com/web/aframe/aframe-extras-4.2.0.min.js"></script>
	    	<script src="https://cdn.8thwall.com/web/xrextras/xrextras.js"></script>

		<!-- 8th Wall API key -->
		<script async src="//apps.8thwall.com/xrweb?appKey=bnWBr8smMOtm8hsLzv1M3AsjyZEPcHize0Tqflu9nYQxqu0yf0fp8mul8iPtRtqb0oR3LW"></script>

		<script>
		        AFRAME.registerComponent('photo-mode', {
		        	init: function() {
		        		const container = document.getElementById('photoModeContainer');
		        		const image = document.getElementById('photoModeImage');
		        		const shutterButton = document.getElementById('shutterButton');
		        		const closeButton = document.getElementById('closeButton');

		        		// Container starts hidden so it isn't visible when the page is still loading
		        		container.style.display = 'block';

		        		closeButton.addEventListener('click', () => {
		        			container.classList.remove('photo');
		        		})

		        		shutterButton.addEventListener('click', () => {
		        			// Emit a screenshotrequest to the xrweb component
		        			this.el.sceneEl.emit('screenshotrequest');

		        			// Show the flash while the image is being taken
		        			container.classList.add('flash');
		        		})

		        		this.el.sceneEl.addEventListener('screenshotready', e => {
		        			// Hide the flash
		        			container.classList.remove('flash');

		        			// If an error occurs while trying to take the screenshot, e.detail will be empty.
		        			// We could either retry or return control to the user
		        			if (!e.detail) {
		        				return;
		        			}

		        			// e.detail is the base64 representation of the JPEG screenshot
		        			image.src = 'data:image/jpeg;base64,' + e.detail;

		        			var a = document.createElement('a');
		        			a.href = image.src;
		        			a.download = "download.jpg";
		        			a.click();

		        			// Show the photo
		        			container.classList.add('photo');
		        		})
		        	}
		        })
                        AFRAME.registerComponent('twitter', {
			    init: function() {
				const container = document.getElementById('tweetContainer');
				container.style.display = 'block';
			    }
                        });

			AFRAME.registerComponent('target-tower', {
			    schema: {
			        name: { type: 'string' }
			    },
			    init: function() {
		                    //var scene = document.querySelector('#target_Tower');
		                    //var scene = document.querySelector('a-scene');
				    /*
                                    var cylinder = document.createElement('a-cylinder');
                                    cylinder.setAttribute('color', '#FF9500');
                                    cylinder.setAttribute('height', '2');
                                    cylinder.setAttribute('radius', '0.75');
                                    cylinder.setAttribute('position', '3 1 0');
                                    scene.appendChild(cylinder);
				    */
				    /*
		                    for(var i = 2; i <= 33; i++) {
		                        var tower_ = document.createElement('a-gltf-model');
                                        tower_.setAttribute('src', '#tower' + String(i));
                                        tower_.setAttribute('id', 'tower_' + String(i));
		                        tower_.setAttribute('scale', '0.0125 0.0125 0.0125');
		                        scale.appendChild(tower_);
		                    }
				    */

				    const showImage = ({detail}) => {
					    document.querySelector('#mall').setAttribute("visible", "false");
					    document.querySelector('#mall_h13').setAttribute("visible", "false");
					    document.querySelector('#h13_top').setAttribute("visible", "false");
					    /*
					    for(var i = 1; i <= 33; i++) {
					        document.querySelector('#tower_' + String(i)).setAttribute("visible", "false");
					        document.querySelector('#tower_' + String(i)).setAttribute("animation", "property: visible; to: true; delay:   " + String(250*i) + ";");
				            }
					    */
				            var i = 1;
					    document.querySelector('#tower_'+String(i)).setAttribute("visible", "false");
					    document.querySelector('#tower_'+String(i)).setAttribute("animation", "property: visible; to: true; delay: 250;");
					    i++;
					    document.querySelector('#tower_'+String(i)).setAttribute("visible", "false");
					    document.querySelector('#tower_'+String(i)).setAttribute("animation", "property: visible; to: true; delay: 500;");
					    i++;
					    document.querySelector('#tower_'+String(i)).setAttribute("visible", "false");
					    document.querySelector('#tower_'+String(i)).setAttribute("animation", "property: visible; to: true; delay: 750;");
					    i++;
					    document.querySelector('#tower_'+String(i)).setAttribute("visible", "false");
					    document.querySelector('#tower_'+String(i)).setAttribute("animation", "property: visible; to: true; delay: 1000;");
					    i++;
					    document.querySelector('#tower_'+String(i)).setAttribute("visible", "false");
					    document.querySelector('#tower_'+String(i)).setAttribute("animation", "property: visible; to: true; delay: 1250;");

					    document.querySelector('#mall').setAttribute("animation", "property: visible; to: true; delay:  1250;")
					    document.querySelector('#mall_h13').setAttribute("animation", "property: visible; to: true; delay:  4000;")
					    document.querySelector('#h13_top').setAttribute("animation", "property: visible; to: true; delay:  7250;")
				    }
				    const hideImage = ({detail}) => {
					    document.querySelector('#mall').removeAttribute("animation")
					    document.querySelector('#mall_h13').removeAttribute("animation")
					    document.querySelector('#h13_top').removeAttribute("animation")

					    var i = 1;
					    document.querySelector('#tower_'+String(i)).removeAttribute("animation")
					    i++;
					    document.querySelector('#tower_'+String(i)).removeAttribute("animation")
					    i++;
					    document.querySelector('#tower_'+String(i)).removeAttribute("animation")
					    i++;
					    document.querySelector('#tower_'+String(i)).removeAttribute("animation")
					    i++;
					    document.querySelector('#tower_'+String(i)).removeAttribute("animation")
					    /*
					    for(var i = 1; i <= 33; i++) {
					        document.querySelector('#tower_' + String(i)).removeAttribute("animation")
				            }
					    */
				    }
				    this.el.sceneEl.addEventListener('xrimagefound', showImage)
				    this.el.sceneEl.addEventListener('xrimagelost', hideImage)
				    this.el.sceneEl.addEventListener('xrimagescanning', hideImage)
			    }
			})
		</script>
	        <link rel="stylesheet" href="index.css">
                <style>
                #tweetContainer {
                	position: absolute;
                	left: 0;
                	top: 0;
                	bottom: 0;
                	right: 0;
                	z-index: 10;
                	pointer-events: none;
                }
                #tweetButton {
                	position: absolute;
                	width: 15vmin;
                	height: 15vmin;
                	background-color: white;
                	bottom: 2vmax;
                	border-radius: 7.5vmin;
                	left: 50%;
                	transform: translateX(-50%);
                	background-size: 50%;
                	background-repeat: no-repeat;
                	background-position: center center;
                	pointer-events: auto;
                }
                </style>
	</head>
	<body>
		<div id="photoModeContainer" style="display: none">
			<img id="photoModeImage">
			<div id="flash"></div>
			<div id="shutterButton" style=""></div>
			<div id="closeButton" style=""></div>
		</div>
		<div id="tweetContainer" style="display: none">
		    <a id="tweetButton" href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a>
		    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div>
		<a-scene
		      xrweb="disableWorldTracking: true"
		      xrextras-almost-there
		      xrextras-runtime-error
		      xrextras-loading
		      twitter
		      photo-mode>
			<a-assets>
				<a-asset-item id="ground" src="model/ground.glb"></a-asset-item>
				<a-asset-item id="mall" src="model/mall.glb"></a-asset-item>
				<a-asset-item id="mall_h13" src="model/mall_h13.glb"></a-asset-item>
				<a-asset-item id="h13_top" src="model/h13_top.glb"></a-asset-item>
				<a-asset-item id="tower1" src="model/01.glb"></a-asset-item>
				<a-asset-item id="tower2" src="model/02.glb"></a-asset-item>
				<a-asset-item id="tower3" src="model/03.glb"></a-asset-item>
				<a-asset-item id="tower4" src="model/04.glb"></a-asset-item>
				<a-asset-item id="tower5" src="model/05.glb"></a-asset-item>
				<a-asset-item id="tower6" src="model/06.glb"></a-asset-item>
				<a-asset-item id="tower7" src="model/07.glb"></a-asset-item>
				<a-asset-item id="tower8" src="model/08.glb"></a-asset-item>
				<a-asset-item id="tower9" src="model/09.glb"></a-asset-item>
				<a-asset-item id="tower10" src="model/10.glb"></a-asset-item>
				<a-asset-item id="tower11" src="model/11.glb"></a-asset-item>
				<a-asset-item id="tower12" src="model/12.glb"></a-asset-item>
				<a-asset-item id="tower13" src="model/13.glb"></a-asset-item>
				<a-asset-item id="tower14" src="model/14.glb"></a-asset-item>
				<a-asset-item id="tower15" src="model/15.glb"></a-asset-item>
				<a-asset-item id="tower16" src="model/16.glb"></a-asset-item>
				<a-asset-item id="tower17" src="model/17.glb"></a-asset-item>
				<a-asset-item id="tower18" src="model/18.glb"></a-asset-item>
				<a-asset-item id="tower19" src="model/19.glb"></a-asset-item>
				<a-asset-item id="tower20" src="model/20.glb"></a-asset-item>
				<a-asset-item id="tower21" src="model/21.glb"></a-asset-item>
				<a-asset-item id="tower22" src="model/22.glb"></a-asset-item>
				<a-asset-item id="tower23" src="model/23.glb"></a-asset-item>
				<a-asset-item id="tower24" src="model/24.glb"></a-asset-item>
				<a-asset-item id="tower25" src="model/25.glb"></a-asset-item>
				<a-asset-item id="tower26" src="model/26.glb"></a-asset-item>
				<a-asset-item id="tower27" src="model/27.glb"></a-asset-item>
				<a-asset-item id="tower28" src="model/28.glb"></a-asset-item>
				<a-asset-item id="tower29" src="model/29.glb"></a-asset-item>
				<a-asset-item id="tower30" src="model/30.glb"></a-asset-item>
				<a-asset-item id="tower31" src="model/31.glb"></a-asset-item>
				<a-asset-item id="tower32" src="model/32.glb"></a-asset-item>
				<a-asset-item id="tower33" src="model/33.glb"></a-asset-item>
				<!-- Credit to Tom Lechner by flickr: https://www.flickr.com/photos/tomlechner/9337477855/ -->
				<img id="backimage" src="image/9337477855_0e3fb2f77e_o.jpg"></img>
			</a-assets>

			<a-camera
				position="0 4 10"
			        raycaster="objects: .cantap"
				cursor="fuse: false; rayOrigin: mouse;">
			</a-camera>

			<a-light type="directional" intensity="0.5"
			       animation="property: position; from: -5 -5 5; to: 5 5 5; dur: 2000; easing: linear; dir: alternate; loop: true">
      			</a-light>

      			<a-light type="ambient" intensity="1"></a-light>

      			<a-entity target-tower xrextras-named-image-target="name: targetTower" id="target_Tower">
			    <a-sky src="#backimage" id="backimage"></a-sky>
			    <a-gltf-model src="#ground" id="ground" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#mall" id="mall" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#mall_h13" id="mall_h13" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#h13_top" id="h13_top" scale="0.0125 0.0125 0.0125"></a-gltf-model>
	                    <a-gltf-model src="#tower1" id="tower_1" scale="0.0125 0.0125 0.0125"> </a-gltf-model>
			    <a-gltf-model src="#tower2" id="tower_2" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower3" id="tower_3" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower4" id="tower_4" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower5" id="tower_5" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower6" id="tower_6" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower7" id="tower_7" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower8" id="tower_8" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower9" id="tower_9" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower10" id="tower_10" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower11" id="tower_11" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower12" id="tower_12" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower13" id="tower_13" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower14" id="tower_14" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower15" id="tower_15" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower16" id="tower_16" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower17" id="tower_17" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower18" id="tower_18" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower19" id="tower_19" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower20" id="tower_20" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower21" id="tower_21" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower22" id="tower_22" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower23" id="tower_23" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower24" id="tower_24" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower25" id="tower_25" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower26" id="tower_26" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower27" id="tower_27" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower28" id="tower_28" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower29" id="tower_29" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower30" id="tower_30" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower31" id="tower_31" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower32" id="tower_32" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			    <a-gltf-model src="#tower33" id="tower_33" scale="0.0125 0.0125 0.0125"></a-gltf-model>
			</a-entity>
		</a-scene>
	</body>
</html>
