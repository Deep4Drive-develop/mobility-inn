<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>デモページ</title>
		<script src="//cdn.8thwall.com/web/aframe/8frame-0.8.2.min.js"></script>
	        <script defer src="//cdn.8thwall.com/web/aframe/aframe-animation-component-5.1.2.min.js"></script>
	        <script src="//cdn.8thwall.com/web/aframe/aframe-extras-4.2.0.min.js"></script>
		<script async src="//apps.8thwall.com/xrweb?appKey=bnWBr8smMOtm8hsLzv1M3AsjyZEPcHize0Tqflu9nYQxqu0yf0fp8mul8iPtRtqb0oR3LW"></script>

	<script>
		AFRAME.registerComponent('photo-mode', {
			init: function() {
				const container = document.getElementById('photoModeContainer');
				const image = document.getElementById('photoModeImage');
				const shutterButton = document.getElementById('shutterButton');
				const closeButton = document.getElementById('closeButton');

				// Container starts hidden so it isn't visible when the page is still loading
				container.style.display = 'block';

				closeButton.addEventListener('click', () => {
					container.classList.remove('photo');
				})

				shutterButton.addEventListener('click', () => {
					// Emit a screenshotrequest to the xrweb component
					this.el.sceneEl.emit('screenshotrequest');

					// Show the flash while the image is being taken
					container.classList.add('flash');
				})

				this.el.sceneEl.addEventListener('screenshotready', e => {
					// Hide the flash
					container.classList.remove('flash');

					// If an error occurs while trying to take the screenshot, e.detail will be empty.
					// We could either retry or return control to the user
					if (!e.detail) {
						return;
					}

					// e.detail is the base64 representation of the JPEG screenshot
					image.src = 'data:image/jpeg;base64,' + e.detail;

					var a = document.createElement('a');
					a.href = image.src;
					a.download = "download.jpg";
					a.click();

					// Show the photo
					container.classList.add('photo');
				})
			}
		})
	</script>
	<link rel="stylesheet" href="index.css">
	</head>
	<body>
		<div id="photoModeContainer" style="display: none">
			<img id="photoModeImage">
			<div id="flash"></div>
			<div id="shutterButton" style=""></div>
			<div id="closeButton" style=""></div>
		</div>
		<a-scene xrweb
			photo-mode>
			<a-assets>
				<!-- Credit to Poly by Google for the model: https://poly.google.com/view/4cH5n4155YD -->
				<a-asset-item id="kabocha" src="model/kabocha.glb"></a-asset-item>
				<a-asset-item id="tower1" src="model/tower_01.glb"></a-asset-item>
				<a-asset-item id="tower2" src="model/tower_02.glb"></a-asset-item>
				<a-asset-item id="tower3" src="model/tower_03.glb"></a-asset-item>
				<a-asset-item id="tower4" src="model/tower_04.glb"></a-asset-item>
				<a-asset-item id="tower5" src="model/tower_05.glb"></a-asset-item>
			</a-assets>

			<a-camera position="0 4 10"></a-camera>

			<a-text value="12/2 DEMO!"
	                        color="red"
			        animation="property: position; from: 0 0 0; to: 5 0 0; dur: 1500; easing: linear; dir: alternate; loop: true"
          	                animation__2="property: scale; from: 1 1 1; to: 3 3 3; dur: 1500; easing: linear; dir: alternate; loop: true">
			</a-text>

			<a-gltf-model src="#kabocha"
	                    animation="property: position; from: 0 3 0; to: 5 3 0; dur: 1500; easing: linear; dir: alternate; loop: true">
			</a-gltf-model>

			<a-gltf-model src="#tower1"
		                      position="-1 -1 -1"
			              rotation="90 0 0"
				      visible="false"
                                      animation="property: visible; to: true; delay: 1000">
			</a-gltf-model>
			<a-gltf-model src="#tower2"
		                      position="-1 -1 -1"
			              rotation="90 0 0"
			 	      visible="false"
                                      animation="property: visible; to: true; delay: 2000">
			</a-gltf-model>
			<a-gltf-model src="#tower3"
		                      position="-1 -1 -1"
			              rotation="90 0 0"
						visible="false"
                                                animation="property: visible; to: true; delay: 3000">
			</a-gltf-model>
			<a-gltf-model src="#tower4"
		                      position="-1 -1 -1"
			              rotation="90 0 0"
				      visible="false"
                                      animation="property: visible; to: true; delay: 4000">
			</a-gltf-model>
			<a-gltf-model src="#tower5"
		                      position="-1 -1 -1"
			              rotation="90 0 0"
			 	      visible="false"
                                      animation="property: visible; to: true; delay: 5000">
			</a-gltf-model>


		</a-scene>
	</body>
</html>
