<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	    	<meta name="apple-mobile-web-app-capable" content="yes">

<<<<<<< HEAD
		<title>fukao page</title>
=======
		<title>fukao ver</title>
>>>>>>> d65a993b38c6a15ada85e6f15620f58e626e522b

		<script src="//cdn.8thwall.com/web/aframe/8frame-0.9.0.min.js"></script>
	        <script defer src="//cdn.8thwall.com/web/aframe/aframe-animation-component-5.1.2.min.js"></script>
	        <script src="//cdn.8thwall.com/web/aframe/aframe-extras-4.2.0.min.js"></script>
	    	<script src="https://cdn.8thwall.com/web/xrextras/xrextras.js"></script>

		<!-- 8th Wall API key -->
		<script async src="//apps.8thwall.com/xrweb?appKey=k5cXnRU1Uvm1gSlh66K6wcqBczvn7sGxjIBoJasdLNJzDDEvPAl8F9bNoJwdtfgSh4t2Kz"></script>

		<script>
			var flag;
		        AFRAME.registerComponent('photo-mode', {
		        	init: function() {
		        		const container = document.getElementById('photoModeContainer');
		        		const image = document.getElementById('photoModeImage');
		        		const shutterButton = document.getElementById('shutterButton');
		        		const closeButton = document.getElementById('closeButton');

		        		// Container starts hidden so it isn't visible when the page is still loading
		        		container.style.display = 'block';

		        		closeButton.addEventListener('click', () => {
		        			container.classList.remove('photo');
		        		})

		        		shutterButton.addEventListener('click', () => {
		        			// Emit a screenshotrequest to the xrweb component
		        			// this.el.sceneEl.emit('screenshotrequest');

						//var link = this.getAttribute('data-link');
						link = "https://twitter.com/intent/tweet?text=あなたの東京タワーにまつわる思い出を投稿しよう！&url=https%3A%2F%2Fdeep4drive-develop.github.io%2Fmobility-inn%2F&hashtags=demo";
						location.href = link;
		        			container.classList.add('photo');
		        		})
		        	}
		        })

			AFRAME.registerComponent('target-tower', {
			    schema: {
			        name: { type: 'string' }
			    },
			    init: function() {
				    flag = false;
				    //entity?は上手くいかない
		                    //var scene = document.querySelector('#target_Tower');
		                    var scene = document.querySelector('a-scene');
				    
		                    var model = document.createElement('a-gltf-model');
                                    model.setAttribute('src', '#ground');
                                    model.setAttribute('id', 'ground');
		                    model.setAttribute('scale', '0.0125 0.0125 0.0125');
			            //model.setAttribute("visible", "false");
		                    scene.appendChild(model);
		                    model = document.createElement('a-gltf-model');
                                    model.setAttribute('src', '#mall');
                                    model.setAttribute('id', 'mall');
		                    model.setAttribute('scale', '0.0125 0.0125 0.0125');
			            model.setAttribute("visible", "false");
		                    scene.appendChild(model);
		                    model = document.createElement('a-gltf-model');
                                    model.setAttribute('src', '#mall_h13');
                                    model.setAttribute('id', 'mall_h13');
		                    model.setAttribute('scale', '0.0125 0.0125 0.0125');
			            model.setAttribute("visible", "false");
		                    scene.appendChild(model);
		                    model = document.createElement('a-gltf-model');
                                    model.setAttribute('src', '#h13_top');
                                    model.setAttribute('id', 'h13_top');
		                    model.setAttribute('scale', '0.0125 0.0125 0.0125');
			            model.setAttribute("visible", "false");
		                    scene.appendChild(model);
		                    for(var i = 1; i <= 33; i++) {
		                        var tower_ = document.createElement('a-gltf-model');
                                        tower_.setAttribute('src', '#tower' + String(i));
                                        tower_.setAttribute('id', 'tower_' + String(i));
		                        tower_.setAttribute('scale', '0.0125 0.0125 0.0125');
			                tower_.setAttribute("visible", "false");
		                        scene.appendChild(tower_);
		                    }

				    const showImage = ({detail}) => {
					    document.querySelector('#mall').removeAttribute("animation")
					    document.querySelector('#mall_h13').removeAttribute("animation")
					    document.querySelector('#h13_top').removeAttribute("animation")
					    for(var i = 1; i <= 33; i++) {
					        document.querySelector('#tower_'+String(i)).removeAttribute("animation")
				            }

					    document.querySelector('#ground').setAttribute("visible", "true");
					    document.querySelector('#mall').setAttribute("visible", "false");
					    document.querySelector('#mall_h13').setAttribute("visible", "false");
					    document.querySelector('#h13_top').setAttribute("visible", "false");
					    for(var i = 1; i <= 33; i++) {
					        document.querySelector('#tower_'+String(i)).setAttribute("visible", "false");
					        document.querySelector('#tower_'+String(i)).setAttribute("animation", "property: visible; to: true; delay: " + String(250*i) + ";");
					    }
					    document.querySelector('#mall').setAttribute("animation", "property: visible; to: true; delay:  1250;")
					    document.querySelector('#mall_h13').setAttribute("animation", "property: visible; to: true; delay:  4000;")
					    document.querySelector('#h13_top').setAttribute("animation", "property: visible; to: true; delay:  7250;")
				    }
				    const hideImage = ({detail}) => {
					    /*
					    document.querySelector('#ground').setAttribute("visible", "false");

					    document.querySelector('#mall').removeAttribute("animation")
					    document.querySelector('#mall_h13').removeAttribute("animation")
					    document.querySelector('#h13_top').removeAttribute("animation")
					    for(var i = 1; i <= 33; i++) {
					        document.querySelector('#tower_'+String(i)).removeAttribute("animation")
				            }
					    */
				    }
				    this.el.sceneEl.addEventListener('xrimagefound', showImage)
				    this.el.sceneEl.addEventListener('xrimagelost', hideImage)
				    this.el.sceneEl.addEventListener('xrimagescanning', hideImage)
			    }
			})
		</script>
	        <link rel="stylesheet" href="index.css">
	</head>
	<body>
		<div id="photoModeContainer" style="display: none">
			<img id="photoModeImage">
			<div id="shutterButton" data-link="https://twitter.com/intent/tweet?text=Hello%20world&url=https%3A%2F%2Fdeep4drive-develop.github.io%2Fmobility-inn%2F&hashtags=demo" style="">tweet</div>
			<div id="closeButton" style=""></div>
		</div>
		<a-scene
		      xrweb="disableWorldTracking: true"
		      xrextras-almost-there
		      xrextras-runtime-error
		      xrextras-loading
		      photo-mode>
			<a-assets>
				<a-asset-item id="model" src="model/dynamic_model.glb"></a-asset-item>

				<!-- Credit to Tom Lechner by flickr: https://www.flickr.com/photos/tomlechner/9337477855/ -->
				<img id="backimage" src="image/9337477855_0e3fb2f77e_o.jpg"></img>
			</a-assets>

			<a-camera
				position="0 4 10"
			        raycaster="objects: .cantap"
				cursor="fuse: false; rayOrigin: mouse;">
			</a-camera>

			<a-light type="directional" intensity="0.5"
			       animation="property: position; from: -5 -5 5; to: 5 5 5; dur: 2000; easing: linear; dir: alternate; loop: true">
      			</a-light>

      			<a-light type="ambient" intensity="1"></a-light>

      			<a-entity target-tower xrextras-named-image-target="name: targetTower" id="target_Tower">
				<a-sky src="#backimage" id="backimage" phi-length="360" phi-start="0" theta-length="90" theta-start="0"></a-sky>
				
			    <a-gltf-model src="#model" id="model" scale="0.0125 0.0125 0.0125"></a-gltf-model>

			</a-entity>
		</a-scene>
	</body>
</html>
